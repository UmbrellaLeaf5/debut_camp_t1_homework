# Домашнее задание 1 - Разработка Backend Java

Лето! а погода - то ноябрь, то жара. Не всем это нравится. Но страна у нас большая. Маша
работает над приложением для комфортного путешествия и при этом любит интересные новые
места. Ей пришла в голову мысль получать данные о метеорологии в текущем времени и
выбирать направление для путешествия прямо в текущий момент.

Подключаемся к метеорологическим станциям, которые дают информацию о погоде.

1. Создать продюсер - отправляющий сообщение в топик Kafka и рассказывающий про погоду.
   Данные о погоде генерировать случайным образом (формат сообщения можно определить
   самостоятельно. Например, температура от 0 до 35 градусов и состояние "солнечно", "облачно",
   "дождь", город, дата)

Создать класс WeatherProducer, который будет отправлять сообщения в Kafka. Топик (название
можно любое, но допустим "weather") в который пишется эта информация будет иметь несколько
консьюмеров - но это не важно, важно отправить эти данные

Предложение: в топик отправляется информация по разным городам за 1 неделю (сутки можно
"сократить" до пяти минут или одной минуты или пары секунд, писать реальную неделю не
обязательно, можно договориться что в сообщении будет дата - не только таймстемп отправки
сообщения но и дата события - когда была зафиксирована конкретная погода)

Петя был рад такой идее, и он хочет собирать статистику - количество солнечных дней в Магадане
и на Чукотке, количество дождей в Питере, когда можно идти за грибами в Тюмени (несколько
дождливых дней) - по этой аналитике он делает свое приложение. Поэтому он попросил
подключения к топику и собирает информацию

2. Создать класс WeatherConsumer, который будет получать сообщения из Kafka. Будет собирать и
   консолидировать данные и как-то их суммировать, и обобщать (здесь жестких ограничений нет,
   аналитика в данном случае на ваше усмотрение. Предлагается такой вариант: собирать данные
   вида "самое большое количество дождливых дней за эту неделю в городе Н, самая жаркая погода была 10 июля в городе К, самая низкая средняя
   температура в городе Ч.")

## Формальное описание (если невыносимо читать про Машин и Петин отпуска)

Создание продюсера:

- Создать класс WeatherProducer, который будет отправлять сообщения в Kafka.

- Реализовать метод, который генерирует случайные данные о погоде (например, температура
  от 0 до 35 градусов и состояние "солнечно", "облачно", "дождь").
- Использовать KafkaProducer для отправки сообщений в заданную тему (например, weather-
  topic).

4. Создание консюмера:

- Создать класс WeatherConsumer, который будет получать сообщения из Kafka.
- Реализовать метод, который подписывается на тему weather-topic и выводит полученные
  сообщения на экран.
- Использовать KafkaConsumer для получения сообщений.

5. Запуск приложения:

- Запустить консюмера, чтобы он начал слушать сообщения.
- Запустить продюсера, который будет периодически отправлять сообщения о погоде
  (например, каждые 2 секунды).

## О проекте (моя реализация)

Проект реализует систему сбора и анализа данных о погоде с использованием Apache Kafka. Система состоит из двух основных компонентов:

1. **WeatherProducer** - генератор случайных данных о погоде для различных городов
2. **WeatherConsumer** - обработчик данных, собирающий статистику и формирующий отчеты

### Технологический стек

- **Apache Kafka 0.11.0.2** - брокер сообщений
- **ZooKeeper** - координация Kafka-кластера
- **Jackson** - работа с JSON
- **Docker** - контейнеризация сервисов
- **Maven** - сборка проекта
- **GitHub Actions** - CI/CD pipeline

### Ключевые особенности реализации

- **Генерация данных**:

  - Поддерживается 5 городов (Магадан, Чукотка, СПб, Тюмень, Москва)
  - 3 типа погодных условий (солнечно, облачно, дождь)
  - Температурный диапазон от `-10°C` до `+35°C`
  - Генерация данных за 7 дней (с историей)

    (всё можно перенастроить, используя config.json)

- **Работа с Kafka**:

  - Настроены параметры надежности доставки (`retries=3`, `acks=all`)
  - Используется один топик `weather_topic` с одним partition
  - Consumer работает в группе `weather-group`

- **Логирование**:

  - Все операции логируются в файлы
  - Отдельные файлы для успешных операций и ошибок
  - Результаты последнего запуска сохраняются в ветке `output`:
    - consumer: https://github.com/UmbrellaLeaf5/debut_t1_homework/blob/output/homework_1/logs/consumer.o
    - producer: https://github.com/UmbrellaLeaf5/debut_t1_homework/blob/output/homework_1/logs/producer.o

- **Специальная (псевдо-) аналитика**:

  - Автоматическое определение времени сбора грибов в Тюмени (после 2 дождливых дней)
  - Анализ типичности погоды в Санкт-Петербурге
  - Отслеживание температурных рекордов по городам

- **CI/CD Pipeline**:

  - Проект интегрирован с [GitHub Actions](https://github.com/UmbrellaLeaf5/debut_t1_homework/actions) - работоспособность системы проверяется при каждом push!

### Запуск проекта

#### Предварительные требования

Перед запуском убедитесь, что у вас установлено:

- Docker (версия 20.10.0 или выше)
- Docker Compose (версия 1.29.0 или выше)
- Git (для клонирования репозитория)

#### Клонирование репозитория

Выполните в командной строке:

```bash
git clone https://github.com/UmbrellaLeaf5/debut_t1_homework/
cd debut_t1_homework/homework_1
```

#### Запуск проекта

Просто выполните команду:

```bash
docker-compose up --build
```

#### Что происходит после запуска

1. Автоматически разворачивается инфраструктура:

   - Сервер ZooKeeper
   - Сервер Kafka
   - Сервис Producer (генератор данных о погоде)
   - Сервис Consumer (анализатор данных)

2. Система начинает работать:
   - Каждые 7 секунд генерируются новые данные о погоде
   - Каждые 3 секунды формируются аналитические отчеты

#### Просмотр результатов

Результаты работы сохраняются в папке `homework_1` в следующих файлах:

- `consumer.o` - отчеты анализатора
- `producer.o` - логи генератора данных
- `consumer.e` - ошибки анализатора (если будут)
- `producer.e` - ошибки генератора (если будут)

Пример содержимого отчета:

```
------------- WEEKLY WEATHER REPORT --------------
City: Saint Petersburg
• Sunny days: 2
• Rainy days: 3
• Cloudy days: 2
• Temperature range: -5°C to 28°C

>> Typical rainy weather in St. Petersburg! <<
```

#### Остановка проекта

Для остановки всех сервисов нажмите `Ctrl+C` в терминале, затем выполните:

```bash
docker-compose down
```

#### Настройка параметров (опционально)

При необходимости вы можете изменить параметры работы в файле `config.json`:

- Список городов
- Погодные условия
- Интервалы генерации данных
- Настройки Kafka

После изменения конфигурации перезапустите проект:

```bash
docker-compose up --build
```
